!function(){"use strict";angular.module("Journal",["journal.config","journal.constants","journal.routes","journal.run","journal.components.editor","journal.components.login","journal.components.postLists","journal.components.sidebar","journal.components.user","journal.components.userCreate","journal.components.userLists","journal.components.userProfile","journal.shared.auth","journal.shared.fileUploader","journal.shared.markdownReader","journal.shared.storage","journal.shared.toastr"]),angular.module("journal.config",["LocalStorageModule","toastr"]),angular.module("journal.constants",[]),angular.module("journal.routes",["ui.router","journal.constants"]),angular.module("journal.run",["ngProgressLite"]),angular.module("journal.components.editor",["ngFileUpload","ui.bootstrap","ui.codemirror"]),angular.module("journal.components.login",[]),angular.module("journal.components.post",[]),angular.module("journal.components.postLists",[]),angular.module("journal.components.sidebar",[]),angular.module("journal.components.user",[]),angular.module("journal.components.userCreate",[]),angular.module("journal.components.userLists",["angularMoment"]),angular.module("journal.components.userProfile",[]),angular.module("journal.shared.auth",[]),angular.module("journal.shared.fileUploader",["ngFileUpload"]),angular.module("journal.shared.markdownReader",[]),angular.module("journal.shared.storage",["LocalStorageModule"]),angular.module("journal.shared.toastr",["ngAnimate","toastr"])}(),function(){"use strict";function e(e){angular.extend(e,{autoDismiss:!1,containerId:"toast-container",maxOpened:5,newestOnTop:!1,positionClass:"toast-bottom-left",preventDuplicates:!1,preventOpenDuplicates:!0,target:"body",timeOut:1e4})}function t(e){e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"]}function r(e){e.setPrefix("journal")}angular.module("journal.config").config(["$httpProvider",t]).config(["toastrConfig",e]).config(["localStorageServiceProvider",r])}(),function(){"use strict";function e(e,t){var r=function(e){return"/assets/templates/"+e};t.otherwise("/").when("/","/post/lists"),e.state("editor",{url:"/editor",views:{"":{templateUrl:r("editor/editor.html")},sidebar:{templateUrl:r("sidebar/sidebar.html")}},authenticate:!0}).state("editorPost",{url:"/editor/:postId",views:{"":{templateUrl:r("editor/editor.html")},sidebar:{templateUrl:r("sidebar/sidebar.html")}},authenticate:!0}).state("login",{url:"/login",templateUrl:r("login/login.html"),authenticate:!1}).state("post",{"abstract":!0,url:"/post",views:{"":{templateUrl:r("post/post.html")},sidebar:{templateUrl:r("sidebar/sidebar.html")}},authenticate:!0}).state("post.lists",{url:"/lists",views:{post_content:{templateUrl:r("post-lists/post-lists.html")}},authenticate:!0}).state("user",{url:"/user",views:{"":{templateUrl:r("user/user.html")},sidebar:{templateUrl:r("sidebar/sidebar.html")}},authenticate:!0}).state("user.create",{url:"/create",views:{user_content:{templateUrl:r("user-create/user-create.html")}},authenticate:!0}).state("user.lists",{url:"/lists",views:{user_content:{templateUrl:r("user-lists/user-lists.html")}},authenticate:!0}).state("user.profile",{url:"/profile/:userId",views:{user_content:{templateUrl:r("user-profile/user-profile.html")}}})}angular.module("journal.routes").config(["$stateProvider","$urlRouterProvider",e])}(),function(){"use strict";function e(e,t,r,o,n){e.$on("$stateChangeStart",function(r,s,i,a,u){n.start(),e.loggedIn=!0,s.authenticate&&!o.user()&&(t.transitionTo("login"),e.loggedIn=!1,r.preventDefault()),"login"==s.name&&(e.loggedIn=!1,o.user()&&(e.loggedIn=!0,t.transitionTo("post.lists"),r.preventDefault()))}),e.$on("$stateChangeSuccess",function(e,t,o,s,i){r(function(){n.done()})})}angular.module("journal.run").run(["$rootScope","$state","$timeout","AuthService","ngProgressLite",e])}(),function(){"use strict";angular.module("journal.constants").constant("CONFIG",{API_URL:"http://localhost:8000/api/v1.0",DEFAULT_AVATAR_URL:"http://40.media.tumblr.com/7d65a925636d6e3df94e2ebe30667c29/tumblr_nq1zg0MEn51qg6rkio1_500.jpg",DEFAULT_COVER_URL:"/assets/images/wallpaper.jpg",VERSION:"2.0.0",CDN_URL:"http://localhost:8000"})}(),function(){"use strict";function e(e,t,r){var o=this;o.options={codemirror:{mode:"markdown",tabMode:"indent",lineWrapping:!0},counter:0,toggle:!1},o.post={status:2,tags:[]},o.convertTimestamp=function(e){if(e){var t=new Date(1e3*e);return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes())}var r=new Date,o=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes());return o},o.initialize=function(){o.post.published_at=o.convertTimestamp(),e.postId&&t.getPost(e.postId).then(function(e){e.post&&(e.post.published_at=o.convertTimestamp(e.post.published_at),o.post=e.post)},function(e){})},o.savePost=function(){var e=o.post;o.processing=!0,t.savePost(e).then(function(e){if(e.post){var t=e.post;o.post.id?r.toast('You have successfully updated "'+t.title+'".',"success"):r.toast('You have successfully created the post"'+t.title+'"',"success"),t.published_at=o.convertTimestamp(t.published_at),o.post=t}o.processing=!1},function(e){o.processing=!1})},o.toggleSidebar=function(){o.options.toggle=!o.options.toggle},o.initialize()}angular.module("journal.components.editor").controller("EditorController",["$stateParams","EditorService","ToastrService",e])}(),function(){"use strict";function e(e,t,r,o){var n=this;n.login={},n.processing=!1,n.authenticateLogin=function(){var s=n.login;n.processing=!1,r.authenticate(s.email,s.password).then(function(r){return r.user&&r.token?(t.login(r.user,r.token),void e.go("post.lists")):void 0},function(e){var t=e.errors.message;return t?void o.toast(t,"error"):void 0})}}angular.module("journal.components.login").controller("LoginController",["$state","AuthService","LoginService","ToastrService",e])}(),function(){"use strict";function e(e){var t=this;t.active=[],t.posts={},t.processing=!0,t.initialize=function(){e.getAllPosts().then(function(e){e.posts&&(t.posts=e.posts,t.active=t.posts[0]),t.processing=!1},function(){})},t.selectThisPost=function(e){t.active=e},t.initialize()}angular.module("journal.components.postLists").controller("PostListsController",["PostListsService",e])}(),function(){"use strict";function e(e,t){var r=this;r.errors={},r.processing=!1,r.roles={},r.user={},r.initialize=function(){t.getRoles().then(function(e){e.roles&&(r.roles=e.roles)},function(e){})},r.createUser=function(){var o=r.user;r.processing=!0,t.createUser(o).then(function(e){e.user&&(r.user={})},function(t){t.errors&&(e.toast("Oops, there some errors encountered.","error"),r.errors=t.errors)})},r.initialize()}angular.module("journal.components.userCreate").controller("UserCreateController",["ToastrService","UserCreateService",e])}(),function(){"use strict";function e(e,t){var r=this;r.processing=!1,r.users=[],r.initialize=function(){e.getUsers().then(function(e){e.users&&(r.users=e.users),r.processing=!1},function(e){})},r.setUserAvatar=function(e){return e.avatar_url?e.avatar_url:t.DEFAULT_AVATAR_URL},r.initialize()}angular.module("journal.components.userLists").controller("UserListsController",["UserListsService","CONFIG",e])}(),function(){"use strict";function e(e,t,r,o){var n=this;n.current=!1,n.loggedInUser=t.user(),n.user={},n.initialize=function(){e.userId&&r.getUser(e.userId).then(function(e){if(e.user){var t=e.user;t.cover_photo=t.cover_photo?t.cover_photo:o.DEFAULT_COVER_URL,t.avatar_url=t.avatar_url?t.avatar_url:o.DEFAULT_AVATAR_URL,n.user=t,n.current=n.loggedInUser.id==t.id}},function(e){})},n.initialize()}angular.module("journal.components.userProfile").controller("UserProfileController",["$stateParams","AuthService","UserProfileService","CONFIG",e])}(),function(){"use strict";function e(){return{restrict:"C",link:function(){angular.element(document.getElementsByClassName("CodeMirror-scroll")[0]).on("scroll",function(e){var t=angular.element(e.target),r=angular.element(document.getElementsByClassName("preview-wrapper")),o=angular.element(document.getElementsByClassName("CodeMirror-sizer")),n=angular.element(document.getElementsByClassName("rendered-markdown")),s=o[0].offsetHeight-t[0].offsetHeight,i=n[0].offsetHeight-r[0].offsetHeight,a=i/s,u=t[0].scrollTop*a;r[0].scrollTop=u})}}}function t(){return{require:"ngModel",restrict:"EA",replace:!0,scope:{ngModel:"=ngModel",post:"=post"},templateUrl:"/assets/templates/editor/_editor-publish-buttons.html",controllerAs:"epb",controller:["$scope",function(e){var t=this;t.options={status:2,active:[],buttons:[{"class":"btn-danger",group:1,status:1,text:"Publish Now"},{"class":"btn-primary",group:1,status:2,text:"Save as Draft"},{"class":"btn-danger",group:2,status:2,text:"Unpublish Post"},{"class":"btn-info",group:2,status:1,text:"Update Post"}]},t.selectPostStatus=function(r){t.options.active=r,t.options.status=t.options.active.status,e.ngModel=t.options.status},t.setButtons=function(e){var r=t.options.buttons[3];2==e&&(r=t.options.buttons[1]),t.options.active=r}}],link:function(e,t,r){e.$watch("post",function(t){e.epb.setButtons(t.status)})}}}function r(){return{require:"ngModel",restrict:"C",scope:{title:"=ngModel",postId:"=postId",slug:"=slug"},controllerAs:"ips",controller:["$scope","EditorService",function(e,t){var r=this;r.checkPostTitle=function(r,o){t.getSlug(r,o).then(function(t){t.slug&&(e.slug=t.slug)},function(e){})}}],link:function(e,t,r,o){t.on("blur",function(){var t=o.$modelValue;t&&0!=t.length&&e.ips.checkPostTitle(t,e.postId)})}}}function o(){return{restrict:"EA",scope:{toggle:"=toggle",postData:"=post"},replace:!0,templateUrl:" /assets/templates/editor/_editor-sidebar.html",controllerAs:"es",controller:["$scope",function(e){var t=this;t.toggle=!1,t.post=[],t.siteUrl=window.location.origin,t.closeSidebar=function(){t.toggle=!1,e.toggle=!1},e.$watchCollection(function(){return t.post},function(t){e.post=t})}],link:function(e,t,r){e.$watch("postData",function(t){e.es.post=t}),e.$watch("toggle",function(t){e.es.toggle=t})}}}function n(){return{restrict:"EA",require:"ngModel",scope:{featuredImage:"=ngModel"},replace:!0,templateUrl:"/assets/templates/editor/_featured-image.html",controllerAs:"fi",controller:["$scope","$timeout","FileUploaderService","ToastrService",function(e,t,r,o){var n=this;n.image={link:null,file:null,option:"file",url:""},n.processing=!1,n.upload={active:!1,percentage:0},n.getImageLink=function(){t(function(){n.image.url=n.image.link,e.featuredImage=n.image.url,n.image.link=null},1e3)},n.removeImage=function(){n.image.url=""},n.switchOption=function(){return"file"==n.image.option?void(n.image.option="link"):"link"==n.image.option?void(n.image.option="file"):void 0},e.$watch(function(){return n.image.file},function(t){t&&r.upload(t).progress(function(e){n.upload={active:!0,percentage:parseInt(100*e.loaded/e.total)}}).success(function(t){t.url&&(n.image.url=t.url,e.featuredImage=n.image.url,n.upload={active:!1,percentage:0})}).error(function(){o.toast("Something went wrong with the upload. Please try again later.","error"),n.upload={active:!1,percentage:0}})})}],link:function(e,t,r,o){e.$watch("featuredImage",function(t){e.fi.image.url=t})}}}angular.module("journal.components.editor").directive("editorScroll",[e]).directive("editorPublishButtons",[t]).directive("inputPostSlug",[r]).directive("editorSidebar",[o]).directive("featuredImage",[n])}(),function(){"use strict";function e(){return{restrict:"E",templateUrl:"/assets/templates/sidebar/_sidebar-directive.html",replace:!0,controllerAs:"sd",controller:["$state","AuthService","SidebarService",function(e,t,r){var o=this;o.sidebar={user:t.user(),title:null},o.initialize=function(){r.getBlogSettings().then(function(e){e.settings&&(o.sidebar.title=e.settings.title)},function(e){})},o.logout=function(){t.logout(),e.go("login")},o.initialize()}]}}angular.module("journal.components.sidebar").directive("journalSidebar",[e])}(),function(){"use strict";function e(e){return{restrict:"AE",scope:{journalMarkdown:"=",counter:"="},link:function(t,r,o){var n=function(){var e=0,o=r.text().replace(/^\s\s*/,"").replace(/\s\s*$/,"");o.length>0&&(e=o.match(/[^\s]+/g).length),t.counter=e};if(o.journalMarkdown)t.$watch("journalMarkdown",function(t){var s=t?e.makeHtml(t):"";o.hideScriptIframe&&(s=s.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,'<div class="embedded-javascript">Embedded JavaScript</div>'),s=s.replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,'<div class="embedded-iframe">Embedded iFrame</div>')),r.html(s),n()});else{var s=e.makeHtml(r.text());o.hideScriptIframe&&(s=s.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,'<div class="embedded-javascript">Embedded JavaScript</div>'),s=s.replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,'<div class="embedded-iframe">Embedded iFrame</div>')),r.html(s),n()}}}}angular.module("journal.shared.markdownReader").directive("journalMarkdown",["MarkdownReader",e])}(),function(){"use strict";function e(){var e={};return{config:function(t){e=t},$get:function(){return new showdown.Converter(e)}}}angular.module("journal.shared.markdownReader").provider("MarkdownReader",[e])}(),function(){"use strict";function e(e,t,r,o){this.apiUrl=o.API_URL,this.getPost=function(r){var o=t.defer();return e.get(this.apiUrl+"/posts/get_post?post_id="+r).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.getSlug=function(r,o){var n=t.defer(),s="slug="+(r||"");return o&&(s+="&post_id="+o),e.get(this.apiUrl+"/posts/check_slug?"+s).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.savePost=function(o){var n=t.defer(),s=r.token(),i=this.apiUrl+"/posts/save?token="+s,a=o.author_id||"",u=o.title||"",l=o.markdown||"",c=o.featured_image||"",d=o.slug||"",p=o.status||2,g=o.tags||[],f=o.published_at.getTime()/1e3||Math.floor(Date.now()/1e3);return o.id&&(i+="&post_id="+o.id),e.post(i,{author_id:a,title:u,markdown:l,featured_image:c,slug:d,status:p,tags:g,published_at:f}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}}angular.module("journal.components.editor").service("EditorService",["$http","$q","AuthService","CONFIG",e])}(),function(){"use strict";function e(e,t,r){this.apiUrl=r.API_URL,this.authenticate=function(r,o){var n=t.defer(),s={email:r,password:o};return e.post(this.apiUrl+"/auth/authenticate",s).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}}angular.module("journal.components.login").service("LoginService",["$http","$q","CONFIG",e])}(),function(){"use strict";function e(e,t,r){this.apiUrl=r.API_URL,this.getAllPosts=function(){var r=t.defer();return e.get(this.apiUrl+"/posts/all").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}angular.module("journal.components.postLists").service("PostListsService",["$http","$q","CONFIG",e])}(),function(){"use strict";function e(e,t,r){this.apiUrl=r.API_URL,this.getBlogSettings=function(){var r=t.defer(),o="title";return e.get(this.apiUrl+"/settings/get?fields="+o).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}angular.module("journal.components.sidebar").service("SidebarService",["$http","$q","CONFIG",e])}(),function(){"use strict";function e(e,t,r,o){this.apiUrl=o.API_URL,this.createUser=function(o){var n=t.defer(),s=r.token();return e.post(this.apiUrl+"/users/create?token="+s,{name:o.name||"",email:o.email||"",password:o.password||"",role:o.role||""}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.getRoles=function(){var r=t.defer();return e.get(this.apiUrl+"/roles/all").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}angular.module("journal.components.userCreate").service("UserCreateService",["$http","$q","AuthService","CONFIG",e])}(),function(){"use strict";function e(e,t,r){this.apiUrl=r.API_URL,this.getUsers=function(){var r=t.defer();return e.get(this.apiUrl+"/users/all").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}angular.module("journal.components.userLists").service("UserListsService",["$http","$q","CONFIG",e])}(),function(){"use strict";function e(e,t,r,o){this.apiUrl=o.API_URL,this.getUser=function(r){var o=t.defer();return e.get(this.apiUrl+"/users/get_user?user_id="+r||"").success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.updateUserDetails=function(e){t.defer()}}angular.module("journal.components.userProfile").service("UserProfileService",["$http","$q","AuthService","CONFIG",e])}(),function(){"use strict";function e(e){this.login=function(t,r){e.set("user",t),e.set("token",r)},this.logout=function(){e.remove("user"),e.remove("token")},this.token=function(){return e.get("token")},this.user=function(){return e.get("user")}}angular.module("journal.shared.auth").service("AuthService",["StorageService",e])}(),function(){"use strict";function e(e,t){this.apiUrl=t.API_URL,this.upload=function(t){return e.upload({url:this.apiUrl+"/upload",file:t})}}angular.module("journal.shared.fileUploader").service("FileUploaderService",["Upload","CONFIG",e])}(),function(){"use strict";function e(e){this.set=function(t,r){return e.set(t,r)},this.get=function(t){return e.get(t)},this.remove=function(t){return e.remove(t)}}angular.module("journal.shared.storage").service("StorageService",["localStorageService",e])}(),function(){"use strict";function e(e){this.toast=function(t,r){switch(r){case"success":e.success(t);break;case"info":e.info(t);break;case"error":e.error(t);break;case"warning":e.warning("message");break;default:e.success(t)}}}angular.module("journal.shared.toastr").service("ToastrService",["toastr",e])}();